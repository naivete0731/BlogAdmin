"use strict";(self["webpackChunkblog_admin"]=self["webpackChunkblog_admin"]||[]).push([[477],{2477:function(t,e,a){a.r(e),a.d(e,{default:function(){return m}});var i=function(){var t=this,e=t._self._c;return e("div",[e("el-card",[e("div",{staticClass:"clearfix header-box",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("管理员列表")]),e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.showAddDialog}},[t._v("添加管理员")])],1),e("el-table",{staticStyle:{width:"100%"},attrs:{border:"",stripe:"",data:t.adminList}},[e("el-table-column",{attrs:{type:"index",label:"序号"}}),e("el-table-column",{attrs:{prop:"avatar",label:"头像",width:"65%"},scopedSlots:t._u([{key:"default",fn:function(a){return[a.row.avatar?e("el-avatar",{attrs:{shape:"square",src:t.baseURL+a.row.avatar.replace(/^public/,"")}}):t._e()]}}])}),e("el-table-column",{attrs:{prop:"username",label:"账号"}}),e("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),e("el-table-column",{attrs:{prop:"role",label:"角色"},scopedSlots:t._u([{key:"default",fn:function({row:e}){return[t._v(" "+t._s("superadmin"===e.role?"超级管理员":"管理员")+" ")]}}])}),e("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:t._u([{key:"default",fn:function({row:e}){return[t._v(" "+t._s(1===e.status?"激活":"未激活")+" ")]}}])}),e("el-table-column",{attrs:{prop:"createTime",label:"注册时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.$formatDate(e.row.createTime))+" ")]}}])}),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function({row:a}){return[e("el-tooltip",{attrs:{enterable:!1,effect:"dark",content:"修改",placement:"top"}},[e("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(e){return t.showEditDialog(a._id)}}})],1),e("el-tooltip",{attrs:{enterable:!1,effect:"dark",content:"删除",placement:"top"}},[e("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(e){return t.removeUserById(a._id)}}})],1)]}}])})],1)],1),e("el-dialog",{attrs:{title:t.isEdit?"修改管理员":"添加管理员",visible:t.EditDialogVisible,width:"30%"},on:{"update:visible":function(e){t.EditDialogVisible=e},close:t.resetFileds}},[e("el-form",{ref:"EditFormRef",attrs:{model:t.EditForm,rules:t.EditFormRules,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"头像"}},[t.EditForm.avatar?e("img",{ref:"imgSrc",staticClass:"the_img",attrs:{src:t.baseURL+t.EditForm.avatar.replace(/^public/,""),alt:"图片"}}):e("img",{ref:"imgSrc",staticClass:"the_img",attrs:{src:a(9389),alt:""}}),e("input",{ref:"iptFile",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*"},on:{change:t.onFileChange}}),e("el-button",{staticStyle:{"vertical-align":"text-bottom","margin-left":"50%"},attrs:{type:"warning",round:""},on:{click:t.chooseImg}},[t._v("更换头像")])],1),e("el-form-item",{attrs:{label:"账号",prop:"username"}},[e("el-input",{attrs:{placeholder:"请输入账号"},model:{value:t.EditForm.username,callback:function(e){t.$set(t.EditForm,"username",e)},expression:"EditForm.username"}})],1),t.isEdit?t._e():e("el-form-item",{attrs:{label:"密码",prop:"password"}},[e("el-input",{attrs:{placeholder:"请输入密码","show-password":""},model:{value:t.EditForm.password,callback:function(e){t.$set(t.EditForm,"password",e)},expression:"EditForm.password"}})],1),e("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[e("el-input",{attrs:{placeholder:"请输入邮箱"},model:{value:t.EditForm.email,callback:function(e){t.$set(t.EditForm,"email",e)},expression:"EditForm.email"}})],1),e("el-form-item",{attrs:{label:"角色",prop:"role"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择角色"},model:{value:t.EditForm.role,callback:function(e){t.$set(t.EditForm,"role",e)},expression:"EditForm.role"}},t._l(t.RoleList,(function(t){return e("el-option",{key:t.role,attrs:{label:t.name,value:t.role}})})),1)],1),e("el-form-item",{attrs:{label:"状态"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择状态"},model:{value:t.EditForm.status,callback:function(e){t.$set(t.EditForm,"status",e)},expression:"EditForm.status"}},t._l(t.RoleState,(function(t){return e("el-option",{key:t.state,attrs:{label:t.name,value:t.state}})})),1)],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.EditDialogVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.upload()}}},[t._v("确 定")])],1)],1)],1)},r=[],s=a(6361),l=a(7877),o={name:"UserList",data(){return{adminList:[],baseURL:s.v,EditDialogVisible:!1,isEdit:!1,EditForm:{avatar:"",username:"",email:"",role:"user",status:1,_id:""},EditFormRules:{username:[{required:!0,message:"请输入账号",trigger:"blur"},{min:2,max:10,message:"账号长度在2~10个字符之间",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在6~20个字符之间",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{pattern:/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,message:"请输入正确的邮箱",trigger:"blur"}],role:[{required:!0,message:"角色不能为空",trigger:"blur"},{pattern:/^(admin|superadmin|user)$/,message:"角色不存在",trigger:"blur"}],status:[{required:!0,message:"状态不能为空",trigger:"blur"},{pattern:/^(0|1)$/,message:"状态不存在",trigger:"blur"}],avatar:[{required:!0,message:"图片不能为空",trigger:"blur"}]},RoleList:[{role:"superadmin",name:"超级管理员"},{role:"admin",name:"管理员"},{role:"user",name:"用户"}],RoleState:[{state:1,name:"激活"},{state:0,name:"未激活"}],uploadFile:{},AddDialogVisible:!1}},created(){this.getAdmin()},methods:{addAdminShowDialog(){this.AddDialogVisible=!0},async getAdmin(){const{data:t}=await(0,l.vl)();if(200!==t.status)return this.$notify.error(t.message);this.adminList=t.data},async showAddDialog(){this.EditDialogVisible=!0,this.isEdit=!1},async showEditDialog(t){this.isEdit=!0,this.EditDialogVisible=!0;const{data:e}=await(0,l.I5)(t);if(200!==e.status)return this.$notify.error(e.message);this.EditForm=e.data},chooseImg(){this.$refs.iptFile.click()},onFileChange(t){const e=t.target.files;0===e.length||(this.$refs.imgSrc.setAttribute("src",URL.createObjectURL(e[0])),this.uploadFile=e[0])},upload(){this.$refs.EditFormRef.validate((async t=>{if(!t)return this.$notify.error("校验未通过");if(this.uploadFile.type){const t=new FormData;t.append("file",this.uploadFile);const{data:e}=await(0,l.ws)(t);if(201!==e.status)return this.$notify.error("头像上传失败");this.EditForm.avatar=e.data.path}else;if(this.isEdit){const{data:t}=await(0,l.rD)(this.EditForm);if(201!==t.status)return this.$notify.error("修改信息失败");this.$notify.success("修改成功"),this.EditDialogVisible=!1,this.getAdmin(),this.$store.dispatch("getUserInfoActions")}else{const{data:t}=await(0,l.kA)(this.EditForm);if(201!==t.status)return this.$notify.error("创建管理员失败"+t.message);this.$notify.success("创建成功"),this.EditDialogVisible=!1,this.getAdmin()}}))},resetFileds(){this.$refs.EditFormRef.resetFields(),this.EditForm={status:1}},async removeUserById(t){const e=await this.$confirm("此操作将导致管理员数据丢失, 是否继续？","提示",{confirmButtonText:"确定",cancelButtonClass:"取消",type:"warning"}).catch((t=>t));if("confirm"===e){const{data:e}=await(0,l.hp)(t);if(201!==e.status)return this.$notify.error(e.message);this.getAdmin(),this.$notify.success("删除成功")}}}},n=o,d=a(1001),u=(0,d.Z)(n,i,r,!1,null,"83afdd10",null),m=u.exports},9389:function(t,e,a){t.exports=a.p+"img/avatar.b216c21d.jpg"}}]);
//# sourceMappingURL=477.e0c2fe18.js.map