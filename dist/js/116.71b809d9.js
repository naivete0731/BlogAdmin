"use strict";(self["webpackChunkblog_admin"]=self["webpackChunkblog_admin"]||[]).push([[116],{9116:function(t,e,s){s.r(e),s.d(e,{default:function(){return m}});var i=function(){var t=this,e=t._self._c;return e("div",[e("el-card",[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("文章管理")])]),e("div",{staticClass:"search-box"},[e("el-form",{attrs:{inline:!0,model:t.q}},[e("el-form-item",{attrs:{label:"文章分类"}},[e("el-select",{attrs:{placeholder:"请选择分类",size:"small"},model:{value:t.q.category,callback:function(e){t.$set(t.q,"category",e)},expression:"q.category"}},t._l(t.CateList,(function(t){return e("el-option",{key:t._id,attrs:{label:t.title,value:t._id}})})),1)],1),e("el-form-item",{staticStyle:{"margin-left":"15px"},attrs:{label:"发布状态"}},[e("el-select",{attrs:{placeholder:"请选择状态",size:"small"},model:{value:t.q.state,callback:function(e){t.$set(t.q,"state",e)},expression:"q.state"}},[e("el-option",{attrs:{label:"已发布",value:"1"}}),e("el-option",{attrs:{label:"未发布",value:"0"}})],1)],1),e("el-form-item",[e("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.choseFn}},[t._v("筛选")]),e("el-button",{attrs:{type:"info",size:"small"},on:{click:t.resetChoseFn}},[t._v("重置")]),0!==t.multipleSelection.length?e("el-button",{attrs:{type:"danger"},on:{click:t.allDelBox}},[t._v("批量删除")]):t._e()],1)],1),e("el-button",{staticClass:"btn-pub",attrs:{type:"parimar",size:"small"},on:{click:function(e){t.drawer=!0}}},[t._v("发表文章")])],1),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.PostList,border:"",stripe:""},on:{"selection-change":t.handleSelectionChange}},[e("el-table-column",{attrs:{type:"selection"}}),e("el-table-column",{attrs:{type:"index",label:"序号"}}),e("el-table-column",{attrs:{label:"标题",prop:"title"}}),e("el-table-column",{attrs:{label:"分类",prop:"category.title"}}),e("el-table-column",{attrs:{label:"发布人",prop:"author.username"}}),e("el-table-column",{attrs:{label:"发布日期",prop:"createAt"},scopedSlots:t._u([{key:"default",fn:function({row:e}){return[t._v(" "+t._s(t.$formatDate(e.createAt))+" ")]}}])}),e("el-table-column",{attrs:{label:"状态",prop:"state"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[0!==s.state?e("span",[t._v("已发布")]):e("span",[t._v("未发布")])]}}])}),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("el-button",{attrs:{size:"mini"},on:{click:function(e){return t.EditPost(s._id)}}},[t._v("编辑")]),e("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(e){return t.RemovePost(s._id)}}},[t._v("删除")])]}}])})],1),e("el-pagination",{attrs:{"current-page":t.q.pagenum,"page-sizes":[5,10,15,20],"page-size":t.q.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChangeFn,"current-change":t.handleCurrentChangeFn,"update:currentPage":function(e){return t.$set(t.q,"pagenum",e)},"update:current-page":function(e){return t.$set(t.q,"pagenum",e)},"update:pageSize":function(e){return t.$set(t.q,"pagesize",e)},"update:page-size":function(e){return t.$set(t.q,"pagesize",e)}}})],1),e("el-drawer",{ref:"drawer",attrs:{title:"发布文章",visible:t.drawer,direction:t.direction,"before-close":t.handleClose,size:"80%"},on:{"update:visible":function(e){t.drawer=e}}},[e("el-form",{ref:"AddPostRef",attrs:{model:t.AddPostForm,rules:t.AddPostFormRules,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"文章标题",prop:"title"}},[e("el-input",{attrs:{placeholder:"请输入文章标题"},model:{value:t.AddPostForm.title,callback:function(e){t.$set(t.AddPostForm,"title",e)},expression:"AddPostForm.title"}})],1),e("el-form-item",{attrs:{label:"文章分类",prop:"category"}},[e("el-select",{attrs:{placeholder:"请选择文章分类"},model:{value:t.AddPostForm.category,callback:function(e){t.$set(t.AddPostForm,"category",e)},expression:"AddPostForm.category"}},t._l(t.CateList,(function(t){return e("el-option",{key:t._id,attrs:{label:t.title,value:t._id}})})),1)],1),e("el-form-item",{attrs:{label:"文章内容",prop:"content"}},[e("quill-editor",{on:{blur:t.contentChange},model:{value:t.AddPostForm.content,callback:function(e){t.$set(t.AddPostForm,"content",e)},expression:"AddPostForm.content"}})],1),e("el-form-item",{attrs:{label:"文章封面"}},[e("img",{ref:"imgRef",staticClass:"cover-img",attrs:{src:s(2921),alt:""},on:{click:t.selCoverFn}}),e("br"),e("input",{ref:"iptFileRef",staticClass:"cover-img",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*"},on:{change:t.changeCoverFn}})]),e("el-form-item",[e("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:function(e){return t.AddValid(1)}}},[t._v(t._s(t.loading?"提交中 ...":"确 定"))]),e("el-button",{attrs:{type:"info"},on:{click:function(e){return t.AddValid(0)}}},[t._v("存为草稿")])],1)],1)],1),e("el-dialog",{attrs:{title:"修改文章",visible:t.EditDialogVisible,width:"80%"},on:{"update:visible":function(e){t.EditDialogVisible=e},close:t.resetFileds}},[e("el-form",{ref:"EditPostRef",attrs:{model:t.AddPostForm,rules:t.AddPostFormRules,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"文章标题",prop:"title"}},[e("el-input",{attrs:{placeholder:"请输入文章标题"},model:{value:t.AddPostForm.title,callback:function(e){t.$set(t.AddPostForm,"title",e)},expression:"AddPostForm.title"}})],1),e("el-form-item",{attrs:{label:"文章分类",prop:"category"}},[e("el-select",{attrs:{placeholder:"请选择文章分类"},model:{value:t.AddPostForm.category._id,callback:function(e){t.$set(t.AddPostForm.category,"_id",e)},expression:"AddPostForm.category._id"}},t._l(t.CateList,(function(t){return e("el-option",{key:t._id,attrs:{label:t.title,value:t._id}})})),1)],1),e("el-form-item",{attrs:{label:"文章内容",prop:"content"}},[e("quill-editor",{on:{blur:t.EditcontentChange},model:{value:t.AddPostForm.content,callback:function(e){t.$set(t.AddPostForm,"content",e)},expression:"AddPostForm.content"}})],1),e("el-form-item",{attrs:{label:"文章封面"}},[t.AddPostForm.thumbnail?e("img",{ref:"imgRef",staticClass:"the_img cover-img",attrs:{src:t.baseURL+t.AddPostForm.thumbnail.replace(/^public/,""),alt:"图片"},on:{click:t.selCoverFn}}):e("img",{ref:"imgRef",staticClass:"the_img cover-img",attrs:{src:s(9389),alt:""},on:{click:t.selCoverFn}}),e("br"),e("input",{ref:"iptFileRef",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*"},on:{change:t.changeCoverFn}})]),e("el-form-item",[e("el-button",{attrs:{type:"primary",loading:t.loading},on:{click:function(e){return t.EditValid(1)}}},[t._v(t._s(t.loading?"提交中 ...":"确 定"))]),e("el-button",{attrs:{type:"info"},on:{click:function(e){return t.EditValid(0)}}},[t._v("存为草稿")])],1)],1)],1)],1)},a=[],o=s(7877),l=s(2921),r=s(6361),n={name:"PostList",data(){return{baseURL:r.v,q:{pagesize:5,pagenum:1,category:"",state:null},total:0,PostList:[],CateList:[],multipleSelection:[],drawer:!1,direction:"ltr",loading:!1,timer:null,AddPostForm:{title:"",state:null,content:"",category:"",thumbnail:null},AddPostFormRules:{title:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:1,max:30,message:"文章标题的长度为1-30个字符",trigger:"blur"}],category:[{required:!0,message:"请选择文章标题",trigger:"blur"}],content:[{required:!0,message:"请输入文章内容",trigger:"change"}]},uploadFile:{},EditDialogVisible:!1,EditPostForm:{title:"",state:null,content:"",category:"",thumbnail:null}}},created(){this.getPost(),this.getCate()},methods:{async getPost(){const{data:t}=await(0,o.x1)(this.q);if(200!==t.status)return this.$notify.error(t.message);this.PostList=t.data.records,this.total=t.data.total},async getCate(){const{data:t}=await(0,o.IR)();if(200!==t.status)return this.$notify.error(t.message);this.CateList=t.data},async choseFn(){this.q.pagenum=1,this.q.pagesize=5,this.getPost()},resetChoseFn(){this.q.state=null,this.q.category="",this.q.pagenum=1,this.q.pagesize=5,this.getPost()},async RemovePost(t){const e=await this.$confirm("此操作将导致管理员数据丢失, 是否继续？","提示",{confirmButtonText:"确定",cancelButtonClass:"取消",type:"warning"}).catch((t=>t));if("confirm"===e){const{data:e}=await(0,o.r6)(t);if(200!==e.status)return this.$notify.error(e.message);this.$notify.success(e.message),this.getPost()}},handleSizeChangeFn(t){this.q.pagesize=t,this.q.pagenum=1,this.getPost()},handleCurrentChangeFn(t){this.q.pagenum=t,this.getPost()},handleSelectionChange(t){this.multipleSelection=t.map((t=>t._id))},allDelBox(){this.RemovePost(this.multipleSelection.join("-"))},handleClose(t){this.$confirm("确认关闭？").then((e=>{this.$refs.AddPostRef.resetFields(),t()})).catch((t=>{}))},selCoverFn(){this.$refs.iptFileRef.click()},changeCoverFn(t){const e=t.target.files;if(0===e.length)this.AddPostForm.thumbnail=null,this.$refs.imgRef.setAttribute("src",l);else{const t=URL.createObjectURL(e[0]);this.$refs.imgRef.setAttribute("src",t),this.uploadFile=e[0]}},EditchangeCoverFn(t){const e=t.target.files;if(0===e.length)this.EditPostForm.thumbnail=null,this.$refs.imgsRef.setAttribute("src",l);else{this.EditPostForm.thumbnail=e[0];const t=URL.createObjectURL(e[0]);this.$refs.imgsRef.setAttribute("src",t),this.uploadFile=e[0]}},contentChange(){this.$refs.AddPostRef.validateField("content")},EditcontentChange(){this.$refs.EditPostRef.validateField("content")},EditValid(t){this.$refs.EditPostRef.validate((async e=>{if(!e)return this.$notify.error("校验未通过");this.PostFn(t,!0)}))},AddValid(t){this.$refs.AddPostRef.validate((async e=>{if(!e)return this.$notify.error("校验未通过");this.PostFn(t,!1)}))},async PostFn(t,e){if(!this.loading){if(this.loading=!0,this.timer=setTimeout((()=>{setTimeout((()=>{this.loading=!1,this.drawer=!1}),400)}),2e3),e)if(this.uploadFile.type){const t=new FormData;t.append("file",this.uploadFile);const{data:e}=await(0,o.ws)(t);if(201!==e.status)return this.$notify.error("头像上传失败");this.AddPostForm.thumbnail=e.data.path}else;else{const t=new FormData;t.append("file",this.uploadFile);const{data:e}=await(0,o.ws)(t);if(201!==e.status)return this.$notify.error("头像上传失败");this.AddPostForm.thumbnail=e.data.path}if(e){const{data:t}=await(0,o.IW)(this.AddPostForm);if(200!==t.status)return this.$notify.error("修改信息失败");this.$notify.success("修改成功"),this.EditDialogVisible=!1,this.getPost()}else{this.AddPostForm.state=t;const{data:e}=await(0,o.Tc)(this.AddPostForm);if(201!==e.status)return this.$notify.error("创建管理员失败"+e.message);this.$notify.success("创建成功"),this.drawer=!1,this.getPost()}}},cancelForm(){this.loading=!1,this.dialog=!1,clearTimeout(this.timer)},resetFileds(){this.$refs.EditPostRef.resetFields(),this.AddPostForm.thumbnail=null,this.AddPostForm.author=null,this.AddPostForm.createAt=null},async EditPost(t){const{data:e}=await(0,o.NU)(t);if(200!==e.status)return this.$notify.error(e.message);this.EditDialogVisible=!0,this.$nextTick((()=>{this.AddPostForm=e.data,this.AddPostForm._id=e.data._id})),this.uploadFile={}}}},d=n,c=s(1001),u=(0,c.Z)(d,i,a,!1,null,"42fe0430",null),m=u.exports},9389:function(t,e,s){t.exports=s.p+"img/avatar.b216c21d.jpg"},2921:function(t,e,s){t.exports=s.p+"img/cover.54bfb07c.jpg"}}]);
//# sourceMappingURL=116.71b809d9.js.map