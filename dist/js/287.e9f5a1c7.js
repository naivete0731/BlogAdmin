"use strict";(self["webpackChunkblog_admin"]=self["webpackChunkblog_admin"]||[]).push([[287],{6287:function(t,e,i){i.r(e),i.d(e,{default:function(){return m}});var s=function(){var t=this,e=t._self._c;return e("div",[e("el-card",[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("轮播列表")]),e("el-button",{attrs:{size:"small"},on:{click:t.ShowAddSlide}},[t._v("添加轮播")])],1),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.SlideList}},[e("el-table-column",{attrs:{prop:"title",label:"标题"}}),e("el-table-column",{attrs:{prop:"image",label:"图片"},scopedSlots:t._u([{key:"default",fn:function({row:i}){return[e("img",{attrs:{src:t.baseURL+i.image.replace(/^public/,""),alt:"",width:"20%"}})]}}])}),e("el-table-column",{attrs:{prop:"link",label:"轮播链接"}}),e("el-table-column",{attrs:{prop:"author.username",label:"作者"}}),e("el-table-column",{scopedSlots:t._u([{key:"default",fn:function({row:i}){return[e("el-button",{on:{click:function(e){return t.delSlide(i._id)}}},[t._v("删除")])]}}])})],1)],1),e("el-dialog",{attrs:{title:"添加轮播",visible:t.AddDialogVisible,width:"50%","before-close":t.handleClose},on:{"update:visible":function(e){t.AddDialogVisible=e}}},[e("el-form",{ref:"AddFormRef",attrs:{rules:t.AddFormRules,"label-width":"100px"},model:{value:t.AddForm,callback:function(e){t.AddForm=e},expression:"AddForm"}},[e("el-form-item",{attrs:{label:"标题",prop:"title"}},[e("el-input",{attrs:{placeholder:"请输入标题"},model:{value:t.AddForm.title,callback:function(e){t.$set(t.AddForm,"title",e)},expression:"AddForm.title"}})],1),e("el-form-item",{attrs:{label:"轮播图片"}},[e("img",{ref:"imgRef",staticClass:"the_img cover-img",attrs:{src:i(9389),alt:""},on:{click:t.selCoverFn}}),e("input",{ref:"iptFileRef",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*"},on:{change:t.changeCoverFn}})]),e("el-form-item",{attrs:{label:"轮播链接",prop:"link"}},[e("el-select",{attrs:{placeholder:"请选择轮播链接"},model:{value:t.AddForm.link,callback:function(e){t.$set(t.AddForm,"link",e)},expression:"AddForm.link"}},t._l(t.PostList.records,(function(t){return e("el-option",{key:t._id,attrs:{label:t.title,value:t._id}})})),1)],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.AddSlide}},[t._v("确 定")])],1)],1)],1)},l=[],a=i(7877),r=i(6361),o=i(2921),n={name:"SlideList",data(){return{baseURL:r.v,SlideList:[],AddDialogVisible:!1,AddForm:{title:"",image:"",link:"",author:""},AddFormRules:{title:[{require:!0,message:"请输入轮播标题",trigger:"blur"},{min:1,max:50,message:"轮播标题超出限制",trigger:"blur"}],link:[{require:!0,message:"请选择链接",trigger:"blur"}]},PostList:[],uploadFile:{}}},created(){this.GetSlide()},methods:{async GetSlide(){const{data:t}=await(0,a.Sb)();if(200!==t.status)return this.$notify.error(t.message);this.SlideList=t.data},async ShowAddSlide(){const{data:t}=await(0,a.x1)({pagesize:50,pagenum:1});if(200!==t.status)return this.$notify.error(t.message);this.PostList=t.data,this.AddDialogVisible=!0},handleClose(t){this.$confirm("确认关闭？").then((e=>{t()})).catch((t=>{}))},selCoverFn(){this.$refs.iptFileRef.click()},changeCoverFn(t){const e=t.target.files;0===e.length?(this.AddForm.image=null,this.$refs.imgRef.setAttribute("src",o)):(this.$refs.imgRef.setAttribute("src",URL.createObjectURL(e[0])),this.uploadFile=e[0])},async AddSlide(){if(this.AddForm.author=this.$store.state.userInfo._id,!this.uploadFile)return this.$notify.error("请上传图片");{const t=new FormData;t.append("file",this.uploadFile);const{data:e}=await(0,a.ws)(t);if(201!==e.status)return this.$notify.error(e.message);this.AddForm.image=e.data.path}const{data:t}=await(0,a.wm)(this.AddForm);if(200!==t.status)return this.$notify.error(t.message);this.$notify.success(t.message),this.GetSlide(),this.AddDialogVisible=!1},async delSlide(t){const e=await this.$confirm("此操作将导致管理员数据丢失, 是否继续？","提示",{confirmButtonText:"确定",cancelButtonClass:"取消",type:"warning"}).catch((t=>t));if("confirm"===e){const{data:e}=await(0,a.TA)(t);if(200!==e.status)return this.$notify.error(e.message);this.GetSlide(),this.$notify.success("删除成功")}}}},d=n,c=i(1001),u=(0,c.Z)(d,s,l,!1,null,"ebcf39fa",null),m=u.exports},9389:function(t,e,i){t.exports=i.p+"img/avatar.b216c21d.jpg"},2921:function(t,e,i){t.exports=i.p+"img/cover.54bfb07c.jpg"}}]);
//# sourceMappingURL=287.e9f5a1c7.js.map