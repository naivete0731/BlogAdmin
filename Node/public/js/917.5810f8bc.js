"use strict";(self["webpackChunkblog_admin"]=self["webpackChunkblog_admin"]||[]).push([[917],{8917:function(t,e,a){a.r(e),a.d(e,{default:function(){return c}});var o=function(){var t=this,e=t._self._c;return e("div",[e("el-card",[e("div",{attrs:{slot:"header"},slot:"header"},[e("span",[t._v("评论管理")]),e("el-button",{attrs:{size:"small"},on:{click:function(e){return t.showDialogComment(!0)}}},[t._v("添加评论")])],1),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.CommentList.records}},[e("el-table-column",{attrs:{type:"selection"}}),e("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function({row:a}){return[e("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[e("el-form-item",{attrs:{label:"用户名"}},[e("span",[t._v(t._s(a.author.nickName))])]),e("el-form-item",{attrs:{label:"邮箱"}},[e("span",[t._v(t._s(a.author.email))])]),e("el-form-item",{attrs:{label:"博客链接"}},[e("span",[t._v(t._s(a.author.page))])])],1)]}}])}),e("el-table-column",{attrs:{prop:"author.nickName",label:"评论人"}}),e("el-table-column",{attrs:{prop:"post.title",label:"评论在"}}),e("el-table-column",{attrs:{prop:"content",label:"评论内容"}}),e("el-table-column",{attrs:{prop:"createAt",label:"评论时间"},scopedSlots:t._u([{key:"default",fn:function({row:e}){return[t._v(" "+t._s(t.$formatDate(e.createAt))+" ")]}}])}),e("el-table-column",{attrs:{prop:"state",label:"状态"},scopedSlots:t._u([{key:"default",fn:function({row:a}){return[e("span",{on:{click:function(e){return t.UpdateState(a._id)}}},[t._v(t._s(1===a.state?"通过":"未通过"))])]}}])}),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function({row:a}){return[e("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(e){return t.DelComment(a._id)}}},[t._v("删除")])]}}])})],1)],1),e("el-dialog",{attrs:{title:"提示",visible:t.dialogVisible,width:"50%"},on:{"update:visible":function(e){t.dialogVisible=e},close:t.handleClose}},[e("el-form",{ref:"CommentRef",attrs:{model:t.CommentForm,rules:t.CommentFormRules,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"昵称",prop:"author.nickName"}},[e("el-input",{attrs:{placeholder:"请输入文章标题"},model:{value:t.CommentForm.author.nickName,callback:function(e){t.$set(t.CommentForm.author,"nickName",e)},expression:"CommentForm.author.nickName"}})],1),e("el-form-item",{attrs:{label:"邮箱",prop:"author.email"}},[e("el-input",{attrs:{type:"email",placeholder:"请输入邮箱"},model:{value:t.CommentForm.author.email,callback:function(e){t.$set(t.CommentForm.author,"email",e)},expression:"CommentForm.author.email"}})],1),e("el-form-item",{attrs:{label:"博客地址"}},[e("el-input",{attrs:{placeholder:"请输入博客地址，可以为空"},model:{value:t.CommentForm.author.page,callback:function(e){t.$set(t.CommentForm.author,"page",e)},expression:"CommentForm.author.page"}})],1),e("el-form-item",{attrs:{label:"评论内容",prop:"content"}},[e("quill-editor",{model:{value:t.CommentForm.content,callback:function(e){t.$set(t.CommentForm,"content",e)},expression:"CommentForm.content"}})],1),e("el-form-item",{attrs:{label:"文章"}},[e("el-select",{attrs:{placeholder:"请选择文章列表"},on:{change:t.SelectPost},model:{value:t.CommentForm.post,callback:function(e){t.$set(t.CommentForm,"post",e)},expression:"CommentForm.post"}},t._l(t.PostList,(function(t){return e("el-option",{key:t._id,attrs:{label:t.title,value:t._id}})})),1)],1),e("el-form-item",{attrs:{label:"回复"}},[e("el-select",{attrs:{placeholder:"请选择回复对象"},model:{value:t.CommentForm.parentCommentId,callback:function(e){t.$set(t.CommentForm,"parentCommentId",e)},expression:"CommentForm.parentCommentId"}},t._l(t.SelectComment,(function(t){return e("el-option",{key:t._id,attrs:{label:t.author.nickName,value:t._id}})})),1)],1)],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.AddComment()}}},[t._v("确 定")])],1)],1)],1)},s=[],r=a(7877),n={name:"COmmentList",data(){return{CommentList:[],SelectComment:[],PostList:[],dialogVisible:!1,CommentForm:{author:{nickName:"",email:"",page:"",avatar:""},content:"",post:"",parentCommentId:"",state:1},CommentFormRules:{author:{nickName:[{required:!0,message:"请输入名称",trigger:"blur"},{max:15,min:2,message:"名称超出范围",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{pattern:/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,message:"请输入正确的邮箱",trigger:"blur"}]},content:[{required:!0,message:"请输入评论内容",trigger:"blur"},{max:100,min:1,message:"评论内容长度不符合",trigger:"blur"}]}}},created(){this.getComment()},methods:{async getComment(){const{data:t}=await(0,r.d7)();if(200!==t.status)return this.$notify.error(t.message);this.CommentList=t.data},async UpdateState(t){const{data:e}=await(0,r.Xr)(t);if(200!==e.status)return this.$notify(e.message);this.$notify.success(e.message),this.getComment()},async DelComment(t){const e=await this.$confirm("此操作将导致评论数据丢失, 是否继续？","提示",{confirmButtonText:"确定",cancelButtonClass:"取消",type:"warning"}).catch((t=>t));if("confirm"===e){const{data:e}=await(0,r.Pi)(t);if(200!==e.status)return this.$notify.error(e.message);this.$notify.success(e.message),this.getComment()}},async showDialogComment(t){const{data:e}=await(0,r.x1)({pagesize:100,pagenum:1,category:"",state:null});if(200!==e.status)return this.$notify.error(e.message);this.PostList=e.data.records,t&&(this.dialogVisible=!0)},handleClose(){this.$refs.CommentRef.resetFields()},async SelectPost(){const{data:t}=await(0,r.Zg)(this.CommentForm.post);if(200!==t.status)return this.$notify.error(t.message);this.SelectComment=t.data},AddComment(){this.$refs.CommentRef.validate((async t=>{if(!t)return this.$notify.error("校验不通过");this.CommentForm.author.avatar=`https://q1.qlogo.cn/g?b=qq&nk=${this.CommentForm.author.email}&s=100&t=time()`;const{data:e}=await(0,r.X6)(this.CommentForm);if(201!==e.status)return this.$notify.error(e.message);this.$notify.success("添加成功"),this.dialogVisible=!1,this.getComment()}))}}},l=n,m=a(1001),i=(0,m.Z)(l,o,s,!1,null,"b0a057c6",null),c=i.exports}}]);
//# sourceMappingURL=917.5810f8bc.js.map